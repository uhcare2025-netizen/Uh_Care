{% extends 'base.html' %}
{% load static %}

{% block title %}Book {{ service.name|default:'Service' }} - UH Care{% endblock %}

{% block extra_css %}
<style>
    /* * == UH CARE PROFESSIONAL BOOKING STYLES ==
     * This CSS block enhances the appearance of the two-column layout,
     * styles the form inputs generated by form.as_p, and establishes
     * the UH Care brand colors for a cohesive experience.
     */
    
    :root {
        /* UH Care Brand Palette & UI Variables */
        --uh-blue: #004a99; /* Primary Brand Blue */
        --uh-blue-700: var(--uh-blue);
        --uh-blue-600: #003a7a;
        --uh-green: #009e4d; /* Secondary Brand Green */
        --uh-green-600: #007a3d;
        --uh-red: #E60000; /* Error/Danger */
        
        --bg-secondary: #F8F9FA; /* Light Gray for background */
        --text-primary: #1C1C1E;
        --text-secondary: #636366;
        --border: #E5E5EA;
        --radius-lg: 12px;
        --radius-md: 8px;
    }
    
    /* Apply a light background to the container area */
    .appointments-container {
        background-color: var(--bg-secondary);
        min-height: calc(100vh - 100px); /* Ensures background color fills vertical space */
    }

    /* Consistent styling for form fields generated by {{ form.as_p }} */
    .appointments-container form p {
        margin-bottom: 1.5rem; /* Space between form fields */
    }
    
    .appointments-container form label {
        display: block;
        font-weight: 600;
        font-size: 0.95rem;
        color: var(--text-primary);
        margin-bottom: 0.4rem;
    }

    input[type="text"],
    input[type="email"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
        display: block;
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        background: #FFFFFF;
        color: var(--text-primary);
        font-size: 1rem;
        transition: border-color 0.2s, box-shadow 0.2s;
        box-sizing: border-box; 
    }

    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: var(--uh-blue);
        box-shadow: 0 0 0 3px rgba(0, 74, 153, 0.15); /* Light blue focus ring */
    }
    
    /* Error and Alert Styling */
    .alert {
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
        border-radius: var(--radius-md);
        border: 1px solid transparent;
        font-size: 0.95rem;
    }
    .alert-error, .alert-danger {
        background: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
    }
    
    /* Styling for errors rendered inside form.as_p */
    .appointments-container form .errorlist {
        display: block;
        color: var(--uh-red);
        font-size: 0.875rem;
        margin-top: 0.5rem;
        list-style: none;
        padding-left: 0;
    }

    /* Button Color Fixes for utility classes (ensures consistency) */
    .bg-uh-blue-700 { background-color: var(--uh-blue); }
    .hover\:bg-uh-blue-600:hover { background-color: var(--uh-blue-600); }
    .focus\:ring-uh-blue-700:focus { box-shadow: 0 0 0 2px var(--uh-blue); }
    
    .text-uh-blue-700 { color: var(--uh-blue); }
    .text-uh-green-600 { color: var(--uh-green-600); }
    
    /* Enhancing card shadows for professionalism */
    .shadow-xl {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    .lg\:col-span-1 .shadow-xl {
        /* Add a subtle brand accent to the service details card */
        border-left: 4px solid var(--uh-blue);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

</style>
{% endblock %}

{% block content %}
<div class="appointments-container max-w-7xl mx-auto py-8 sm:py-12 px-4 sm:px-6 lg:px-8">

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-xl overflow-hidden p-6 sm:p-8">
                <h1 class="text-3xl font-bold text-uh-blue-700 mb-6">Book Service</h1>

                <div class="space-y-3">
                    <p class="text-gray-600">Service:
                        <strong class="font-semibold text-gray-900">{{ service.name }}</strong>
                    </p>
                    <p class="text-gray-600">Price:
                        <strong class="font-bold text-uh-green-600 text-2xl">{% if service.get_price_display %}{{ service.get_price_display }}{% else %}N/A{% endif %}</strong>
                    </p>
                </div>

                <div class="border-t border-gray-200 pt-4 mt-4">
                    <p class="text-sm text-gray-600">
                        {% if service.short_description %}{{ service.short_description }}{% else %}{{ service.description|default:'' }}{% endif %}
                    </p>
                </div>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                <form method="post">
                    {% csrf_token %}

                    <div class="p-6 sm:p-8">
                        <h2 class="text-2xl font-bold text-uh-blue-700 mb-6">Your details</h2>

                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">{{ form.non_field_errors }}</div>
                        {% endif %}

                        {{ form.as_p }}
                    </div>

                    <div class="bg-gray-50 px-6 sm:px-8 py-5 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4">
                        <button type="submit" class="w-full sm:w-auto bg-uh-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-uh-blue-600 focus:outline-none focus:ring-2 focus:ring-uh-blue-700 focus:ring-offset-2 transition-all duration-200">
                            Confirm Booking
                        </button>
                        <a href="{% url 'services:list' %}" class="w-full sm:w-auto text-center font-medium text-gray-700 bg-white border border-gray-300 py-3 px-6 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-200">
                            Back to Services
                        </a>
                    </div>
                </form>
            </div>
        </div>

    </div> </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Apply consistent classes to form fields rendered via form.as_p so they match the page styles.
    const form = document.querySelector('.appointments-container form');
    if (!form) return;

    const addClasses = (el, classes) => {
        if (!el) return;
        const existing = (el.className || '').trim().split(/\s+/).filter(Boolean);
        const toAdd = classes.trim().split(/\s+/).filter(Boolean);
        const merged = Array.from(new Set([...existing, ...toAdd]));
        el.className = merged.join(' ');
    };

    // Text-like inputs and textarea
    const textSelectors = 'input[type="text"], input[type="email"], input[type="number"], input[type="date"], textarea';
    form.querySelectorAll(textSelectors).forEach(el => {
        addClasses(el, 'px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-uh-blue-600 focus:border-transparent transition-colors duration-200');
    });

    // Selects
    form.querySelectorAll('select').forEach(el => {
        addClasses(el, 'form-select px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm transition-colors duration-200');
    });

    // Mark required fields for assistive tech when using form.as_p
    form.querySelectorAll('input[required], select[required], textarea[required]').forEach(el => {
        el.setAttribute('aria-required', 'true');
    });

    // Improve focus outline for keyboard users (extra safeguard)
    form.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') document.documentElement.classList.add('user-is-tabbing');
    });
});
</script>
{% endblock %}