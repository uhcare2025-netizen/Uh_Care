{% extends 'base.html' %}
{% load static %}

{% block title %}Service Booking #{{ appointment.id }} - UH Care{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 sm:py-12 px-4 sm:px-6 lg:px-8">
    <!-- Header Card -->
    <div class="bg-white rounded-lg shadow-xl overflow-hidden p-6 sm:p-8 mb-8">
        <h1 class="text-3xl font-bold text-uh-blue-700">Service Booking #{{ appointment.id }}</h1>
        <p class="text-lg text-gray-600 mt-2">
            Status: <strong class="font-semibold text-gray-900">{{ appointment.get_status_display }}</strong>
            <span class="mx-2 text-gray-300">•</span>
            Booked by <strong class="font-semibold text-gray-900">{{ appointment.patient.get_full_name }}</strong>
        </p>
    </div>

    <!-- Two-column grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Left Column: Main Details -->
        <section class="lg:col-span-2 bg-white rounded-lg shadow-xl overflow-hidden p-6 sm:p-8">
            <div>
                <h2 class="text-2xl font-semibold text-uh-blue-700 mb-3">Service</h2>
                <p class="text-lg font-medium text-gray-900"><strong>{{ appointment.service.name }}</strong></p>
                <p class="text-sm text-gray-500">Category: {{ appointment.service.category.name }}</p>
            </div>

            <div class="border-t border-gray-200 my-6"></div>

            <div>
                <h3 class="text-2xl font-semibold text-uh-blue-700 mb-3">Schedule</h3>
                <p class="text-lg text-gray-800">{{ appointment.appointment_date|date:"F d, Y" }} at {{ appointment.appointment_time|time:"g:i A" }}</p>
                <p class="text-sm text-gray-500">Duration: {{ appointment.duration_hours }} hour(s)</p>
            </div>

            <div class="border-t border-gray-200 my-6"></div>

            <div>
                <h3 class="text-2xl font-semibold text-uh-blue-700 mb-3">Location</h3>
                <p class="text-base text-gray-800">{{ appointment.service_address }}</p>
            </div>

            {% if appointment.patient_notes %}
            <div class="border-t border-gray-200 my-6"></div>
            <div>
                <h3 class="text-2xl font-semibold text-uh-blue-700 mb-3">Patient Notes</h3>
                <p class="text-base text-gray-800">{{ appointment.patient_notes }}</p>
            </div>
            {% endif %}

        </section>

        <!-- Right Column: Summary & Actions -->
        <aside class="lg:col-span-1 bg-white rounded-lg shadow-xl overflow-hidden p-6 sm:p-8 h-fit">
            <h3 class="text-2xl font-semibold text-uh-blue-700 mb-6">Booking Summary</h3>

                <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Service Price</span>
                    {% if appointment.final_price %}
                        <span class="font-semibold text-gray-900 text-lg">रू {{ appointment.final_price }} <small class="text-xs text-gray-500">(final)</small></span>
                    {% else %}
                        <span class="font-semibold text-gray-900 text-lg">रू {{ appointment.service_price }} <small class="text-xs text-gray-500">(estimated)</small></span>
                    {% endif %}
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Additional Charges</span>
                    <span class="font-semibold text-gray-900 text-lg">रू {{ appointment.additional_charges }}</span>
                </div>

                <div class="border-t border-gray-200 pt-4 mt-4"></div>

                <div class="flex justify-between items-center">
                    <span class="text-gray-600 font-bold">Total</span>
                    <span class="font-bold text-uh-green-600 text-2xl">रू {{ appointment.total_amount }}</span>
                </div>
            </div>

            <div class="border-t border-gray-200 my-6"></div>

            <!-- Actions Section -->
            <div class="space-y-4">
                {% if payment %}
                <div>
                    <div class_ ="text-sm text-gray-600 mb-1">Payment Status</div>
                    <div class="font-semibold text-gray-900 text-lg"><strong>{{ payment.get_payment_status_display }}</strong></div>
                </div>
                {% else %}
                <div>
                    <a href="{% url 'payments:initiate' appointment.id %}" class="w-full block text-center bg-uh-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-uh-blue-600 focus:outline-none focus:ring-2 focus:ring-uh-blue-700 focus:ring-offset-2 transition-all duration-200">
                        Pay Now
                    </a>
                </div>
                {% endif %}

                {% if user.is_staff %}
                <div>
                    <a href="{% url 'admin:appointments_appointment_change' appointment.id %}" class="w-full block text-center font-semibold text-gray-700 bg-white border border-gray-300 py-3 px-6 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-200">
                        Edit in Admin
                    </a>
                </div>
                {% endif %}
            </div>
        </aside>
    </div>
</div>
{% endblock %}